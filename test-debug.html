<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Debug - Application Photo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #0F0F23 0%, #1A1A2E 50%, #16213E 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        h1 {
            text-align: center;
            color: #4ECDC4;
            margin-bottom: 30px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            background: linear-gradient(135deg, #FF6B9D, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        button.danger {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
        }
        button.success {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
        }
        .status {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #4ECDC4;
        }
        .log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .error {
            border-left-color: #FF6B6B;
            color: #FF6B6B;
        }
        .success {
            border-left-color: #4ECDC4;
            color: #4ECDC4;
        }
        .warning {
            border-left-color: #FFD93D;
            color: #FFD93D;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug - Application Photo</h1>
        
        <div class="status">
            <h3>√âtat actuel de l'application :</h3>
            <div id="appStatus">Chargement...</div>
        </div>
        
        <div class="button-group">
            <button onclick="checkStatus()">üîç V√©rifier l'√©tat</button>
            <button onclick="testInit()">üß™ Tester l'initialisation</button>
            <button onclick="forceInit()">‚ö° Forcer l'initialisation</button>
            <button class="danger" onclick="disableServices()">üö´ D√©sactiver les services</button>
            <button class="success" onclick="enableServices()">‚úÖ R√©activer les services</button>
            <button onclick="clearLog()">üóëÔ∏è Effacer les logs</button>
        </div>
        
        <div class="button-group">
            <button onclick="analyzeAll()">üîç Analyser toutes les photos</button>
            <button onclick="stopAll()">‚èπÔ∏è Arr√™ter toutes les analyses</button>
            <button onclick="testStoreFunctions()">üß™ Tester les fonctions du store</button>
            <button onclick="diagnoseProblem()">üîç Diagnostic du probl√®me</button>
            <button onclick="testAutoInit()">üöÄ Tester l'init automatique</button>
            <button onclick="testIntelligentInit()">üß† Tester l'init intelligente</button>
            <button onclick="openApp()">üöÄ Ouvrir l'application</button>
            <button onclick="openSearch()">üîç Ouvrir la page recherche</button>
            <button onclick="reloadApp()">üîÑ Recharger l'application</button>
        </div>
        
        <div class="log" id="log">
            === D√©marrage du debug ===
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logElement.textContent += `\n[${timestamp}] ${prefix} ${message}`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').textContent = '=== Logs effac√©s ===';
        }

        function updateStatus(status) {
            const statusElement = document.getElementById('appStatus');
            statusElement.innerHTML = `
                <strong>Services IA:</strong> ${status.store.isInitialized ? '‚úÖ Initialis√©s' : status.store.isLoading ? '‚è≥ En cours...' : '‚ùå Non initialis√©s'}<br>
                <strong>Erreur:</strong> ${status.store.error || 'Aucune'}<br>
                <strong>Service de d√©tection:</strong> ${status.detectionService ? '‚úÖ Pr√™t' : '‚ùå Non disponible'}<br>
                <strong>Service de reconnaissance:</strong> ${status.recognitionService ? '‚úÖ Pr√™t' : '‚ùå Non disponible'}
            `;
        }

        async function checkStatus() {
            try {
                log('V√©rification de l\'√©tat des services...');
                if (window.debugFaceServices) {
                    const status = window.debugFaceServices.checkStatus();
                    updateStatus(status);
                    log('√âtat v√©rifi√© avec succ√®s', 'success');
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors de la v√©rification: ${error.message}`, 'error');
            }
        }

        async function testInit() {
            try {
                log('Test d\'initialisation des services...');
                if (window.debugFaceServices) {
                    const result = await window.debugFaceServices.testInit();
                    log(`R√©sultat du test: ${JSON.stringify(result)}`, 'success');
                    checkStatus();
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors du test: ${error.message}`, 'error');
            }
        }

        async function forceInit() {
            try {
                log('Force de l\'initialisation des services...');
                if (window.debugFaceServices) {
                    const result = await window.debugFaceServices.forceInit();
                    log(`R√©sultat de la force: ${JSON.stringify(result)}`, 'success');
                    checkStatus();
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors de la force: ${error.message}`, 'error');
            }
        }

        function disableServices() {
            try {
                log('D√©sactivation des services...');
                if (window.debugFaceServices) {
                    const result = window.debugFaceServices.disable();
                    log(`Services d√©sactiv√©s: ${JSON.stringify(result)}`, 'success');
                    checkStatus();
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors de la d√©sactivation: ${error.message}`, 'error');
            }
        }

        function enableServices() {
            try {
                log('R√©activation des services...');
                if (window.debugFaceServices) {
                    const result = window.debugFaceServices.enable();
                    log(`Services r√©activ√©s: ${JSON.stringify(result)}`, 'success');
                    checkStatus();
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors de la r√©activation: ${error.message}`, 'error');
            }
        }

        function analyzeAll() {
            try {
                log('Analyse de toutes les photos en attente...');
                if (window.debugFaceServices) {
                    window.debugFaceServices.analyzeAll().then(result => {
                        log(`Analyse lanc√©e: ${JSON.stringify(result)}`, 'success');
                        checkStatus();
                    }).catch(error => {
                        log(`Erreur lors de l'analyse: ${error.message}`, 'error');
                    });
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors de l'analyse: ${error.message}`, 'error');
            }
        }

        function stopAll() {
            try {
                log('Arr√™t de toutes les analyses...');
                if (window.debugFaceServices) {
                    const result = window.debugFaceServices.stopAll();
                    log(`Analyses arr√™t√©es: ${JSON.stringify(result)}`, 'success');
                    checkStatus();
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors de l'arr√™t: ${error.message}`, 'error');
            }
        }

        function testStoreFunctions() {
            try {
                log('Test des fonctions du store...');
                if (window.debugFaceServices) {
                    const result = window.debugFaceServices.testStoreFunctions();
                    log(`R√©sultat du test: ${JSON.stringify(result)}`, 'success');
                    checkStatus();
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors du test: ${error.message}`, 'error');
            }
        }

        function diagnoseProblem() {
            try {
                log('üîç Diagnostic du probl√®me...');
                
                // Test 1: V√©rifier si l'application est charg√©e
                if (typeof window !== 'undefined') {
                    log('‚úÖ Window disponible', 'success');
                } else {
                    log('‚ùå Window non disponible', 'error');
                    return;
                }
                
                // Test 2: V√©rifier si le store est charg√©
                if (window.debugFaceServices) {
                    log('‚úÖ Services de debug disponibles', 'success');
                } else {
                    log('‚ùå Services de debug non disponibles', 'error');
                    log('L\'application n\'est peut-√™tre pas charg√©e', 'warning');
                    return;
                }
                
                // Test 3: V√©rifier les fonctions individuelles
                const tests = [
                    { name: 'getState', func: () => window.debugFaceServices.getState() },
                    { name: 'checkStatus', func: () => window.debugFaceServices.checkStatus() },
                    { name: 'disable', func: () => window.debugFaceServices.disable() },
                    { name: 'enable', func: () => window.debugFaceServices.enable() }
                ];
                
                tests.forEach(test => {
                    try {
                        const result = test.func();
                        log(`‚úÖ ${test.name}: Fonctionne`, 'success');
                    } catch (error) {
                        log(`‚ùå ${test.name}: Erreur - ${error.message}`, 'error');
                    }
                });
                
            } catch (error) {
                log(`Erreur lors du diagnostic: ${error.message}`, 'error');
            }
        }

        function openApp() {
            log('Ouverture de l\'application...');
            window.open('http://localhost:3000', '_blank');
        }

        function openSearch() {
            log('Ouverture de la page de recherche...');
            window.open('http://localhost:3000/#/face-search', '_blank');
        }

        function reloadApp() {
            log('Rechargement de l\'application...');
            if (window.opener) {
                window.opener.location.reload();
            } else {
                window.location.reload();
            }
        }

        function testAutoInit() {
            try {
                log('Test de l\'initialisation intelligente...');
                if (window.debugFaceServices) {
                    // D√©sactiver d'abord pour simuler un √©tat non initialis√©
                    window.debugFaceServices.disable();
                    log('Services d√©sactiv√©s pour le test', 'success');
                    
                    // Attendre un peu puis v√©rifier
                    setTimeout(() => {
                        const status = window.debugFaceServices.checkStatus();
                        log(`√âtat apr√®s d√©sactivation: ${JSON.stringify(status)}`, 'info');
                        
                        // Maintenant forcer l'initialisation
                        window.debugFaceServices.forceInit().then(result => {
                            log(`Initialisation forc√©e: ${JSON.stringify(result)}`, 'success');
                            
                            // V√©rifier l'√©tat final
                            setTimeout(() => {
                                const finalStatus = window.debugFaceServices.checkStatus();
                                log(`√âtat final: ${JSON.stringify(finalStatus)}`, 'success');
                            }, 1000);
                        }).catch(error => {
                            log(`Erreur lors de l'init: ${error.message}`, 'error');
                        });
                    }, 500);
                    
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors du test: ${error.message}`, 'error');
            }
        }

        function testIntelligentInit() {
            try {
                log('üß† Test du syst√®me d\'initialisation intelligente...');
                if (window.debugFaceServices) {
                    // Simuler le processus d'import d'image
                    log('üì∏ Simulation d\'import d\'image de r√©f√©rence...');
                    
                    // V√©rifier l'√©tat initial
                    const initialStatus = window.debugFaceServices.checkStatus();
                    log(`√âtat initial: ${JSON.stringify(initialStatus)}`, 'info');
                    
                    if (!initialStatus.store.isInitialized) {
                        log('‚ö° Services non initialis√©s - Initialisation intelligente...', 'warning');
                        
                        // Simuler l'initialisation
                        window.debugFaceServices.forceInit().then(result => {
                            log(`‚úÖ Initialisation intelligente r√©ussie: ${JSON.stringify(result)}`, 'success');
                            
                            // Simuler l'analyse des photos
                            log('üîç Simulation de l\'analyse des photos non analys√©es...', 'info');
                            
                            // V√©rifier l'√©tat final
                            setTimeout(() => {
                                const finalStatus = window.debugFaceServices.checkStatus();
                                log(`√âtat final: ${JSON.stringify(finalStatus)}`, 'success');
                                log('üéØ Syst√®me pr√™t pour la recherche optimis√©e!', 'success');
                            }, 1000);
                            
                        }).catch(error => {
                            log(`‚ùå Erreur d'initialisation intelligente: ${error.message}`, 'error');
                        });
                    } else {
                        log('‚úÖ Services d√©j√† initialis√©s - Pr√™t pour la recherche', 'success');
                    }
                    
                } else {
                    log('Services de debug non disponibles', 'error');
                }
            } catch (error) {
                log(`Erreur lors du test: ${error.message}`, 'error');
            }
        }

        // V√©rification automatique au chargement
        window.addEventListener('load', () => {
            log('Page de debug charg√©e', 'success');
            setTimeout(() => {
                if (window.debugFaceServices) {
                    log('Services de debug disponibles', 'success');
                    checkStatus();
                } else {
                    log('Services de debug non disponibles - L\'application n\'est peut-√™tre pas charg√©e', 'warning');
                }
            }, 1000);
        });

        // V√©rification p√©riodique
        setInterval(() => {
            if (window.debugFaceServices) {
                const status = window.debugFaceServices.checkStatus();
                if (status.store.isLoading) {
                    log('Services en cours d\'initialisation...', 'warning');
                }
            }
        }, 5000);
    </script>
</body>
</html> 